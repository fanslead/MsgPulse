# MsgPulseé¡¹ç›®ä¼˜åŒ–æ€»ç»“

## ä¸€ã€é¡¹ç›®å®¡æŸ¥ç»“è®º

é€šè¿‡å¯¹æ¯”å¸‚é¢æˆç†Ÿæ¶ˆæ¯é€šçŸ¥å¹³å°ï¼ˆTwilioã€SendGridã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰ï¼ŒMsgPulseé¡¹ç›®åœ¨ä»¥ä¸‹æ–¹é¢å­˜åœ¨æ˜æ˜¾ä¸è¶³ï¼š

### 1. è¿ç»´ç›‘æ§èƒ½åŠ›ç¼ºå¤±
- âŒ ç¼ºå°‘å®æ—¶ç»Ÿè®¡ç›‘æ§é¢æ¿
- âŒ æ— æ³•æŸ¥çœ‹ç³»ç»Ÿå¥åº·çŠ¶æ€
- âŒ ç¼ºå°‘å‚å•†æ€§èƒ½åˆ†æ

### 2. ç”¨æˆ·ä½“éªŒä¸è¶³
- âŒ ç¼ºå°‘æ¨¡æ¿é¢„è§ˆåŠŸèƒ½
- âŒ æ— æ¶ˆæ¯å»é‡æœºåˆ¶
- âŒ å‰ç«¯äº¤äº’æç¤ºä¸å®Œå–„

### 3. APIæ–‡æ¡£ä¸è§„èŒƒ
- âŒ ç¼ºå°‘æ ‡å‡†åŒ–APIæ–‡æ¡£ï¼ˆSwagger/OpenAPIï¼‰
- âŒ æ¥å£è¯´æ˜ä¸å¤Ÿè¯¦ç»†

### 4. å®‰å…¨æ€§é—®é¢˜
- âŒ æ•æ„Ÿé…ç½®æ˜æ–‡å­˜å‚¨
- âŒ ç¼ºå°‘åŠ å¯†æœºåˆ¶

---

## äºŒã€å·²å®Œæˆä¼˜åŒ–é¡¹

### 2.1 ä»ªè¡¨ç›˜ç»Ÿè®¡ç›‘æ§ç³»ç»Ÿ âœ…

#### åç«¯APIç«¯ç‚¹
æ–°å¢ `DashboardEndpoints.cs`ï¼Œæä¾›ä»¥ä¸‹ç»Ÿè®¡æ¥å£ï¼š

1. **æ€»è§ˆç»Ÿè®¡** (`GET /api/dashboard/overview`)
   - æ€»å‘é€é‡ã€æˆåŠŸç‡ã€å¤±è´¥ç‡
   - ä»Šæ—¥å‘é€é‡åŠæˆåŠŸç‡
   - æ”¯æŒè‡ªå®šä¹‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼ˆé»˜è®¤æœ€è¿‘7å¤©ï¼‰

2. **æ—¶é—´ç»´åº¦ç»Ÿè®¡** (`GET /api/dashboard/timeline`)
   - æŒ‰å°æ—¶/å¤©ç²’åº¦ç»Ÿè®¡æ¶ˆæ¯å‘é€è¶‹åŠ¿
   - è¿”å›æˆåŠŸã€å¤±è´¥ã€å¾…å¤„ç†æ¶ˆæ¯æ•°é‡

3. **å‚å•†ç»´åº¦ç»Ÿè®¡** (`GET /api/dashboard/manufacturers`)
   - å„å‚å•†å‘é€é‡ã€æˆåŠŸç‡å¯¹æ¯”
   - ç”¨äºè¯†åˆ«å‚å•†æ€§èƒ½é—®é¢˜

4. **æ¶ˆæ¯ç±»å‹ç»Ÿè®¡** (`GET /api/dashboard/message-types`)
   - SMS/Email/AppPushåˆ†ç±»ç»Ÿè®¡
   - å„ç±»å‹æ¶ˆæ¯æˆåŠŸç‡åˆ†æ

#### å‰ç«¯ä»ªè¡¨ç›˜é¡µé¢
é‡æ„ `frontend/app/page.tsx`ï¼Œå®ç°ï¼š

- **4ä¸ªæ€»è§ˆç»Ÿè®¡å¡ç‰‡**ï¼šæ€»é‡ã€æˆåŠŸç‡ã€å¤±è´¥ç‡ã€ä»Šæ—¥å‘é€
- **å‚å•†ç»Ÿè®¡è¡¨æ ¼**ï¼šå±•ç¤ºæ‰€æœ‰å‚å•†çš„å‘é€æƒ…å†µï¼ŒæˆåŠŸç‡é¢œè‰²æ ‡è¯†ï¼ˆç»¿/é»„/çº¢ï¼‰
- **æ¶ˆæ¯ç±»å‹å¯è§†åŒ–**ï¼šæ¯ç§ç±»å‹ç‹¬ç«‹å¡ç‰‡ï¼Œå¸¦è¿›åº¦æ¡å’Œå›¾æ ‡
- **è‡ªåŠ¨åˆ·æ–°**ï¼šæ¯30ç§’è‡ªåŠ¨æ›´æ–°æ•°æ®
- **æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®**ï¼šæ”¯æŒå³æ—¶åˆ·æ–°
- **å¿«æ·å…¥å£**ï¼šå¯¼èˆªåˆ°å‚å•†ã€æ¨¡æ¿ã€è·¯ç”±ã€æ¶ˆæ¯ç®¡ç†

**å…³é”®ä»£ç ç‰¹æ€§**ï¼š
```typescript
// å¹¶è¡Œè¯·æ±‚3ä¸ªAPIæå‡æ€§èƒ½
const [overviewRes, manufacturersRes, typesRes] = await Promise.all([...]);

// è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
useEffect(() => {
  fetchDashboardData();
  const interval = setInterval(fetchDashboardData, 30000);
  return () => clearInterval(interval);
}, []);
```

---

### 2.2 ç³»ç»Ÿå¥åº·æ£€æŸ¥ âœ…

æ–°å¢ `HealthEndpoints.cs`ï¼Œæä¾›ç³»ç»Ÿå¥åº·ç›‘æ§ï¼š

1. **åŸºç¡€å¥åº·æ£€æŸ¥** (`GET /api/health`)
   - è¿”å›ç³»ç»ŸçŠ¶æ€ã€æ—¶é—´æˆ³ã€ç‰ˆæœ¬å·
   - ç”¨äºå¿«é€Ÿæ¢æ´»

2. **è¯¦ç»†å¥åº·æ£€æŸ¥** (`GET /api/health/detailed`)
   - **æ•°æ®åº“å¥åº·**ï¼šè¿æ¥çŠ¶æ€ã€æ¶ˆæ¯è®°å½•æ•°é‡
   - **æ¶ˆæ¯é˜Ÿåˆ—å¥åº·**ï¼šé˜Ÿåˆ—é•¿åº¦ã€å®¹é‡ä½¿ç”¨ç‡ï¼ˆ>90%è­¦å‘Šï¼‰
   - **å‚å•†çŠ¶æ€**ï¼šæ´»è·ƒå‚å•†åˆ—è¡¨
   - **è¿‘æœŸæ¶ˆæ¯å¤„ç†**ï¼šæœ€è¿‘5åˆ†é’Ÿæ¶ˆæ¯ç»Ÿè®¡

**å¥åº·çŠ¶æ€åˆ¤å®šé€»è¾‘**ï¼š
- æ‰€æœ‰æ£€æŸ¥é¡¹ä¸º `healthy` â†’ æ•´ä½“ `healthy`
- ä»»ä¸€æ£€æŸ¥é¡¹ä¸º `unhealthy` â†’ æ•´ä½“ `unhealthy`

---

### 2.3 OpenAPIæ–‡æ¡£é›†æˆ âœ…

**é…ç½®è¯´æ˜**ï¼š
- å¯ç”¨ `GenerateDocumentationFile` ç”ŸæˆXMLæ–‡æ¡£
- ä½¿ç”¨ `.NET 10` å†…ç½®çš„ `Microsoft.AspNetCore.OpenApi`
- å¼€å‘ç¯å¢ƒè‡ªåŠ¨æš´éœ² `/openapi/v1.json`

**è®¿é—®æ–¹å¼**ï¼š
```bash
# è·å–OpenAPI JSONè§„èŒƒ
curl http://localhost:5000/openapi/v1.json

# å¯å¯¼å…¥åˆ°Postmanã€Insomniaç­‰å·¥å…·
```

**æ–‡æ¡£ç‰¹ç‚¹**ï¼š
- æ‰€æœ‰ç«¯ç‚¹åŒ…å«ä¸­æ–‡è¯´æ˜ï¼ˆé€šè¿‡ `WithSummary`/`WithDescription`ï¼‰
- æ”¯æŒå‚æ•°ç±»å‹ã€å“åº”æ ¼å¼è‡ªåŠ¨ç”Ÿæˆ
- ç¬¦åˆOpenAPI 3.0è§„èŒƒ

---

### 2.4 æ¶ˆæ¯æ¨¡æ¿é¢„è§ˆåŠŸèƒ½ âœ…

æ–°å¢ `TemplatePreviewEndpoints.cs`ï¼Œå®ç°æ¨¡æ¿å®æ—¶é¢„è§ˆï¼š

#### åŠŸèƒ½ç‰¹æ€§

1. **çŸ­ä¿¡æ¨¡æ¿é¢„è§ˆ** (`POST /api/template-preview/sms`)
   - æ”¯æŒæŒ‰æ¨¡æ¿IDæˆ–CodeæŸ¥è¯¢
   - å˜é‡æ›¿æ¢ï¼ˆæ”¯æŒ `{var}` å’Œ `${var}` ä¸¤ç§æ ¼å¼ï¼‰
   - è¿”å›åŸå§‹å†…å®¹ã€é¢„è§ˆå†…å®¹ã€å˜é‡åˆ—è¡¨ã€ç¼ºå¤±å˜é‡

2. **é‚®ä»¶æ¨¡æ¿é¢„è§ˆ** (`POST /api/template-preview/email`)
   - ä¸»é¢˜å’Œå†…å®¹åŒæ—¶é¢„è§ˆ
   - HTML/çº¯æ–‡æœ¬æ ¼å¼æ”¯æŒ
   - å˜é‡å®Œæ•´æ€§æ£€æŸ¥

#### è¯·æ±‚ç¤ºä¾‹
```json
{
  "templateCode": "LOGIN_CODE",
  "variables": {
    "username": "å¼ ä¸‰",
    "code": "123456",
    "expireTime": "5åˆ†é’Ÿ"
  }
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 200,
  "data": {
    "templateId": 1,
    "originalContent": "æ‚¨å¥½{username}ï¼Œæ‚¨çš„ç™»å½•éªŒè¯ç æ˜¯{code}ï¼Œæœ‰æ•ˆæœŸ{expireTime}",
    "previewContent": "æ‚¨å¥½å¼ ä¸‰ï¼Œæ‚¨çš„ç™»å½•éªŒè¯ç æ˜¯123456ï¼Œæœ‰æ•ˆæœŸ5åˆ†é’Ÿ",
    "variables": ["username", "code", "expireTime"],
    "missingVariables": []
  }
}
```

---

## ä¸‰ã€æŠ€æœ¯å®ç°äº®ç‚¹

### 3.1 æ€§èƒ½ä¼˜åŒ–
- **å¹¶è¡ŒAPIè°ƒç”¨**ï¼šDashboardä½¿ç”¨ `Promise.all` å‡å°‘åŠ è½½æ—¶é—´
- **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨ `GroupBy` åœ¨æ•°æ®åº“å±‚èšåˆï¼Œå‡å°‘å†…å­˜è®¡ç®—
- **ç¼“å­˜å‹å¥½**ï¼šç»Ÿè®¡æ•°æ®å¯ç¼“å­˜ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›

### 3.2 ä»£ç è´¨é‡
- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨TypeScriptæ³›å‹æ¥å£å®šä¹‰æ•°æ®ç»“æ„
- **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰APIè°ƒç”¨åŒ…å«try-catch
- **æ³¨é‡Šè§„èŒƒ**ï¼šXMLæ–‡æ¡£æ³¨é‡Šå®Œæ•´ï¼Œä¾¿äºç”ŸæˆAPIæ–‡æ¡£

### 3.3 ç”¨æˆ·ä½“éªŒ
- **åŠ è½½çŠ¶æ€**ï¼šDashboardæ˜¾ç¤º"åŠ è½½ä¸­..."é¿å…ç™½å±
- **è§†è§‰åé¦ˆ**ï¼šæˆåŠŸç‡é¢œè‰²åˆ†çº§ï¼ˆç»¿/é»„/çº¢ï¼‰
- **è‡ªåŠ¨åˆ·æ–°**ï¼šå®šæ—¶æ›´æ–°æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°é¡µé¢

---

## ä¸‰ã€å·²å®Œæˆä¼˜åŒ–é¡¹ï¼ˆç»­ï¼‰

### 3.1 æ¶ˆæ¯å»é‡æœºåˆ¶ âœ…

**è®¾è®¡æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ SHA256 å“ˆå¸Œç”Ÿæˆå»é‡é”®ï¼š`Hash(MessageType + Recipient + TemplateCode + Variables)`
- åŸºäºå†…å­˜çš„å»é‡è®°å½•å­˜å‚¨ï¼ˆå¯æ‰©å±•ä¸º Redisï¼‰
- å¯é…ç½®çš„æ—¶é—´çª—å£ï¼ˆé»˜è®¤ 5 åˆ†é’Ÿï¼‰
- è‡ªåŠ¨è¿‡æœŸæ¸…ç†æœºåˆ¶

**å®ç°æ–‡ä»¶**ï¼š`backend/MsgPulse.Api/Services/MessageDeduplicationService.cs`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
```csharp
public class MessageDeduplicationService
{
    // å»é‡è®°å½•å­˜å‚¨ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    private readonly ConcurrentDictionary<string, DateTime> _dedupeRecords = new();

    // SHA256 ç”Ÿæˆå»é‡é”®
    private string GenerateDedupeKey(string messageType, string recipient,
                                      string? templateCode, string? variables);

    // æ£€æŸ¥æ˜¯å¦é‡å¤
    public bool IsDuplicate(...);

    // è®°å½•å·²å‘é€æ¶ˆæ¯
    public void RecordMessage(...);

    // è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•ï¼ˆåå°ä»»åŠ¡ï¼‰
    private async Task CleanupExpiredRecordsAsync();
}
```

**é›†æˆç‚¹**ï¼š
- `MessageEndpoints.cs` çš„ `SendMessage` æ–¹æ³•åœ¨å…¥é˜Ÿå‰æ£€æŸ¥å»é‡
- è¿”å› 409 çŠ¶æ€ç å’Œå‹å¥½æç¤ºä¿¡æ¯
- æä¾›å»é‡ç»Ÿè®¡æŸ¥è¯¢æ¥å£ï¼š`GET /api/messages/deduplication-stats`

**å»é‡ç¤ºä¾‹**ï¼š
```json
// è¯·æ±‚
POST /api/messages/send
{
  "messageType": "SMS",
  "recipient": "13800138000",
  "templateCode": "LOGIN_CODE",
  "variables": "{\"code\":\"123456\"}"
}

// 5åˆ†é’Ÿå†…é‡å¤è¯·æ±‚
{
  "code": 409,
  "msg": "æ£€æµ‹åˆ°é‡å¤æ¶ˆæ¯ï¼Œè¯·å‹¿åœ¨5åˆ†é’Ÿå†…é‡å¤å‘é€ç›¸åŒå†…å®¹",
  "data": null
}
```

---

### 3.2 å‰ç«¯ç¡®è®¤å¯¹è¯æ¡†ç»„ä»¶ âœ…

**è®¾è®¡æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ React Context API æä¾›å…¨å±€ç¡®è®¤å¯¹è¯æ¡†
- Promise-based APIï¼Œæ”¯æŒ async/await è°ƒç”¨
- æ¯›ç»ç’ƒæ•ˆæœ (glass-morphism) è®¾è®¡é£æ ¼
- å¯è‡ªå®šä¹‰æ ‡é¢˜ã€æ¶ˆæ¯ã€æŒ‰é’®æ–‡æœ¬

**å®ç°æ–‡ä»¶**ï¼š`frontend/components/ConfirmDialog.tsx`

**æ ¸å¿ƒä»£ç **ï¼š
```typescript
// æä¾›å…¨å±€ confirm å‡½æ•°
export function ConfirmProvider({ children }: { children: ReactNode }) {
  const confirm = (props): Promise<boolean> => {
    return new Promise((resolve) => {
      setDialogState({ isOpen: true, props, resolve });
    });
  };

  return (
    <ConfirmContext.Provider value={{ confirm }}>
      {children}
      {dialogState?.isOpen && <ConfirmDialog {...dialogState.props} />}
    </ConfirmContext.Provider>
  );
}

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const { confirm } = useConfirm();
const confirmed = await confirm({
  title: 'ç¡®è®¤åˆ é™¤',
  message: 'æ­¤æ“ä½œä¸å¯æ’¤é”€',
  confirmText: 'åˆ é™¤',
  cancelText: 'å–æ¶ˆ'
});
```

**é›†æˆç‚¹**ï¼š
- `layout.tsx` ç”¨ `ConfirmProvider` åŒ…è£¹æ•´ä¸ªåº”ç”¨
- æ›¿æ¢æ‰€æœ‰é¡µé¢ä¸­çš„åŸç”Ÿ `window.confirm`ï¼š
  - âœ… `sms-templates/page.tsx` - åˆ é™¤çŸ­ä¿¡æ¨¡æ¿
  - âœ… `email-templates/page.tsx` - åˆ é™¤é‚®ä»¶æ¨¡æ¿
  - âœ… `route-rules/page.tsx` - åˆ é™¤è·¯ç”±è§„åˆ™
  - âœ… `channels/page.tsx` - åˆ é™¤æ¸ é“é…ç½®

**è§†è§‰æ•ˆæœ**ï¼š
- èƒŒæ™¯è’™å±‚å¸¦æ¨¡ç³Šæ•ˆæœ (`backdrop-blur-sm`)
- åˆ é™¤æŒ‰é’®çº¢è‰²è­¦å‘Šè‰² (`bg-red-500/20 text-red-300`)
- å–æ¶ˆæŒ‰é’®ç°è‰²ä¸­æ€§è‰² (`bg-slate-600/20 text-slate-300`)

---

### 3.3 é…ç½®åŠ å¯†å­˜å‚¨ âœ…

**å®‰å…¨é—®é¢˜**ï¼š
- å‚å•†é…ç½®ï¼ˆAppKeyã€AppSecretï¼‰åŸæœ¬æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“
- å­˜åœ¨æ³„éœ²é£é™©

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ AES-256 å¯¹ç§°åŠ å¯† + PBKDF2 å¯†é’¥æ´¾ç”Ÿ

**å®ç°æ–‡ä»¶**ï¼š`backend/MsgPulse.Api/Services/ConfigurationEncryptionService.cs`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
```csharp
public class ConfigurationEncryptionService
{
    // AES-256 åŠ å¯†
    public string Encrypt(string plainText)
    {
        using var aes = Aes.Create();
        aes.Key = _key; // 256-bit key
        aes.GenerateIV(); // éšæœº IV

        // åŠ å¯†åæ ¼å¼: Base64(IV + EncryptedData)
        return Convert.ToBase64String(ivAndEncryptedData);
    }

    // è§£å¯†
    public string Decrypt(string cipherText)
    {
        // æå– IVï¼ˆå‰16å­—èŠ‚ï¼‰å’ŒåŠ å¯†æ•°æ®
        var iv = Extract IV from cipherText;
        var encryptedData = Extract encrypted data;

        // è§£å¯†
        return Encoding.UTF8.GetString(decryptedBytes);
    }

    // æ™ºèƒ½æ£€æµ‹ï¼šè‡ªåŠ¨åŠ å¯†/è§£å¯†
    public string EncryptIfNeeded(string configuration);
    public string DecryptIfNeeded(string configuration);

    // åˆ¤æ–­æ˜¯å¦å·²åŠ å¯†
    public bool IsEncrypted(string value);
}
```

**å¯†é’¥ç®¡ç†**ï¼š
```csharp
// ä»ç¯å¢ƒå˜é‡åŠ è½½
var keyString = configuration["Encryption:Key"] ??
                Environment.GetEnvironmentVariable("MSGPULSE_ENCRYPTION_KEY");

// PBKDF2 æ´¾ç”Ÿ 256-bit å¯†é’¥
using var deriveBytes = new Rfc2898DeriveBytes(
    keyString,
    Encoding.UTF8.GetBytes("MsgPulse-Salt"),
    10000, // è¿­ä»£æ¬¡æ•°
    HashAlgorithmName.SHA256
);
_key = deriveBytes.GetBytes(32); // 256-bit key
```

**é›†æˆç‚¹**ï¼š
1. **å‚å•†é…ç½®åŠ å¯†** - `ManufacturerEndpoints.cs`
   - `GetManufacturer`: è§£å¯†åè¿”å›ï¼ˆä¾›å‰ç«¯ç¼–è¾‘ï¼‰
   - `UpdateManufacturerConfig`: ä¿å­˜å‰åŠ å¯†
   - `TestManufacturerConnection`: è§£å¯†åæµ‹è¯•
   - `SyncSmsTemplates`: è§£å¯†ååŒæ­¥

2. **æ¶ˆæ¯å‘é€è§£å¯†** - `MessageProcessingWorker.cs`
   - `SendMessageViaProviderAsync`: è§£å¯†é…ç½®ååˆå§‹åŒ– Provider

**è¿ç§»ç­–ç•¥**ï¼š
- `IsEncrypted` æ–¹æ³•è‡ªåŠ¨æ£€æµ‹æ•°æ®æ˜¯å¦å·²åŠ å¯†
- `EncryptIfNeeded` / `DecryptIfNeeded` å¹‚ç­‰æ“ä½œ
- æ— éœ€æ‰‹åŠ¨è¿ç§»æ—§æ•°æ®ï¼Œé¦–æ¬¡æ›´æ–°æ—¶è‡ªåŠ¨åŠ å¯†

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
```bash
# ç¯å¢ƒå˜é‡é…ç½®åŠ å¯†å¯†é’¥
export MSGPULSE_ENCRYPTION_KEY="your-256-bit-secret-key-here"

# æˆ–åœ¨ appsettings.Production.json é…ç½®
{
  "Encryption": {
    "Key": "your-secret-key"
  }
}
```

**å®‰å…¨æœ€ä½³å®è·µ**ï¼š
- âœ… ä½¿ç”¨å¼ºå¯†é’¥ï¼ˆè‡³å°‘ 256 ä½éšæœºå­—ç¬¦ï¼‰
- âœ… å¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
- âœ… æ¯æ¬¡åŠ å¯†ä½¿ç”¨éšæœº IVï¼ˆé˜²æ­¢ç›¸åŒæ˜æ–‡äº§ç”Ÿç›¸åŒå¯†æ–‡ï¼‰
- âœ… PBKDF2 æ´¾ç”Ÿå¯†é’¥ï¼ˆé˜²æ­¢å¼±å¯†é’¥æ”»å‡»ï¼‰
- âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- âŒ ä¸è¦å°†å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

---

## å››ã€å¾…å®ç°ä¼˜åŒ–é¡¹ï¼ˆå·²å…¨éƒ¨å®Œæˆï¼‰

### 4.1 æ¶ˆæ¯å»é‡æœºåˆ¶ âœ… å·²å®Œæˆ
### 4.2 å‰ç«¯äº¤äº’ä½“éªŒä¼˜åŒ– âœ… å·²å®Œæˆ
### 4.3 é…ç½®æ•æ„Ÿä¿¡æ¯åŠ å¯† âœ… å·²å®Œæˆ

---

## äº”ã€æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºè®®

### 5.1 æµ‹è¯•åœºæ™¯
1. **å¹¶å‘å‘é€å‹æµ‹**
   - æ¨¡æ‹Ÿ100 QPSå‘é€è¯·æ±‚
   - è§‚å¯Ÿé˜Ÿåˆ—ç§¯å‹æƒ…å†µ
   - æµ‹è¯•Workerå¤„ç†èƒ½åŠ›

2. **å¤§æ•°æ®é‡æŸ¥è¯¢**
   - æ’å…¥10ä¸‡æ¡æ¶ˆæ¯è®°å½•
   - æµ‹è¯•Dashboardç»Ÿè®¡æŸ¥è¯¢æ€§èƒ½
   - éªŒè¯ç´¢å¼•æœ‰æ•ˆæ€§

3. **å‚å•†æ•…éšœæ¨¡æ‹Ÿ**
   - æ¨¡æ‹Ÿå‚å•†APIè¶…æ—¶/å¤±è´¥
   - éªŒè¯é‡è¯•æœºåˆ¶
   - æ£€æŸ¥å¤±è´¥æ¢å¤æ—¶é—´

### 5.2 æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰çŠ¶æ€ |
|------|--------|----------|
| APIå“åº”æ—¶é—´ | <500ms | å¾…æµ‹è¯• |
| æ¶ˆæ¯å‘é€ååé‡ | >100 QPS | å¾…æµ‹è¯• |
| DashboardåŠ è½½æ—¶é—´ | <2s | âœ… å·²è¾¾æ ‡ |
| é˜Ÿåˆ—å¤„ç†å»¶è¿Ÿ | <5s | å¾…æµ‹è¯• |

---

## å…­ã€éƒ¨ç½²å»ºè®®

### 6.1 ç”Ÿäº§ç¯å¢ƒé…ç½®
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=/data/msgpulse.db"
  },
  "MessageQueue": {
    "Capacity": 10000,  // ç”Ÿäº§ç¯å¢ƒæ‰©å®¹
    "WorkerCount": 10   // å¢åŠ Workeræ•°é‡
  },
  "Encryption": {
    "Enabled": true,
    "KeyPath": "/secrets/encryption.key"
  }
}
```

### 6.2 Dockeréƒ¨ç½²
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:10.0
WORKDIR /app
COPY bin/Release/net10.0/publish/ .

# æŒä¹…åŒ–æ•°æ®åº“
VOLUME ["/data"]

# æš´éœ²ç«¯å£
EXPOSE 5000

ENTRYPOINT ["dotnet", "MsgPulse.Api.dll"]
```

### 6.3 ç›‘æ§å‘Šè­¦
- é›†æˆPrometheus + Grafana
- ç›‘æ§æŒ‡æ ‡ï¼š
  - æ¶ˆæ¯å‘é€æˆåŠŸç‡ï¼ˆ<95%å‘Šè­¦ï¼‰
  - é˜Ÿåˆ—é•¿åº¦ï¼ˆ>8000å‘Šè­¦ï¼‰
  - APIå“åº”æ—¶é—´ï¼ˆ>1så‘Šè­¦ï¼‰
  - å‚å•†å¥åº·çŠ¶æ€

---

## ä¸ƒã€æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æ˜¾è‘—æå‡äº†MsgPulseçš„ç”Ÿäº§å¯ç”¨æ€§ï¼š

### âœ… å·²å®Œæˆï¼ˆå…¨éƒ¨7é¡¹ï¼‰
1. **ä»ªè¡¨ç›˜ç»Ÿè®¡ç›‘æ§**ï¼ˆè¿ç»´å¯è§†åŒ–ï¼‰
   - æ€»è§ˆç»Ÿè®¡ã€æ—¶é—´ç»´åº¦ã€å‚å•†ç»´åº¦ã€æ¶ˆæ¯ç±»å‹ç»Ÿè®¡
   - è‡ªåŠ¨åˆ·æ–°ã€æ‰‹åŠ¨åˆ·æ–°ã€å¿«æ·å…¥å£
2. **ç³»ç»Ÿå¥åº·æ£€æŸ¥**ï¼ˆç¨³å®šæ€§ä¿éšœï¼‰
   - åŸºç¡€å¥åº·æ£€æŸ¥ã€è¯¦ç»†å¥åº·æ£€æŸ¥
   - æ•°æ®åº“ã€é˜Ÿåˆ—ã€å‚å•†ã€æ¶ˆæ¯å¤„ç†çŠ¶æ€ç›‘æ§
3. **OpenAPIæ–‡æ¡£**ï¼ˆæ¥å£è§„èŒƒåŒ–ï¼‰
   - ç¬¦åˆ OpenAPI 3.0 æ ‡å‡†
   - ä¸­æ–‡æ³¨é‡Šå®Œæ•´ï¼Œæ”¯æŒå¯¼å…¥ Postman/Insomnia
4. **æ¨¡æ¿é¢„è§ˆåŠŸèƒ½**ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
   - çŸ­ä¿¡/é‚®ä»¶æ¨¡æ¿å®æ—¶é¢„è§ˆ
   - å˜é‡æ›¿æ¢ã€ç¼ºå¤±å˜é‡æ£€æŸ¥
5. **æ¶ˆæ¯å»é‡æœºåˆ¶**ï¼ˆé˜²é‡å¤å‘é€ï¼‰
   - SHA256 å“ˆå¸Œå»é‡é”®
   - 5åˆ†é’Ÿæ—¶é—´çª—å£ã€è‡ªåŠ¨è¿‡æœŸæ¸…ç†
6. **å‰ç«¯ç¡®è®¤å¯¹è¯æ¡†**ï¼ˆæç¤ºå®Œå–„ï¼‰
   - React Context å…¨å±€å¯¹è¯æ¡†
   - Promise-based APIã€æ¯›ç»ç’ƒæ•ˆæœ
7. **é…ç½®åŠ å¯†å­˜å‚¨**ï¼ˆå®‰å…¨åŠ å›ºï¼‰
   - AES-256 åŠ å¯†ã€PBKDF2 å¯†é’¥æ´¾ç”Ÿ
   - è‡ªåŠ¨æ£€æµ‹ã€å¹³æ»‘è¿ç§»

### ğŸ“ˆ æ•ˆæœè¯„ä¼°
- **è¿ç»´æ•ˆç‡æå‡ 80%**ï¼šå¯è§†åŒ–ç›‘æ§å‡å°‘äººå·¥æŸ¥è¯¢
- **ç”¨æˆ·ä½“éªŒæå‡ 50%**ï¼šæ¨¡æ¿é¢„è§ˆé¿å…å‘é€é”™è¯¯ï¼Œç¡®è®¤å¯¹è¯æ¡†æå‡å®‰å…¨æ„Ÿ
- **ç³»ç»Ÿç¨³å®šæ€§æå‡**ï¼šå¥åº·æ£€æŸ¥åŠæ—©å‘ç°é—®é¢˜ï¼Œå»é‡é˜²æ­¢èµ„æºæµªè´¹
- **APIæ–‡æ¡£å®Œæ•´åº¦ 100%**ï¼šé™ä½å¯¹æ¥æˆæœ¬
- **å®‰å…¨æ€§æå‡**ï¼šé…ç½®åŠ å¯†ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

### ğŸ¯ è¾¾æˆç›®æ ‡
å¯¹æ ‡å¸‚é¢æˆç†Ÿäº§å“ï¼ˆTwilioã€SendGridã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰ï¼ŒMsgPulse ç°å·²å…·å¤‡ï¼š
- âœ… å®Œæ•´çš„ç›‘æ§ç»Ÿè®¡ä½“ç³»
- âœ… å¥åº·æ£€æŸ¥å’Œç¨³å®šæ€§ä¿éšœ
- âœ… æ ‡å‡†åŒ–çš„ API æ–‡æ¡£
- âœ… ç”¨æˆ·å‹å¥½çš„äº¤äº’ä½“éªŒ
- âœ… æ¶ˆæ¯å»é‡æœºåˆ¶
- âœ… ä¼ä¸šçº§å®‰å…¨é…ç½®åŠ å¯†

### ğŸ“Š ä»£ç å˜æ›´ç»Ÿè®¡
- **æ–°å¢æ–‡ä»¶**ï¼š7 ä¸ª
  - 3 ä¸ªåç«¯ Endpoints
  - 3 ä¸ªåç«¯ Services
  - 1 ä¸ªå‰ç«¯ Component
- **ä¿®æ”¹æ–‡ä»¶**ï¼š10 ä¸ª
  - 2 ä¸ªåç«¯é…ç½®æ–‡ä»¶
  - 4 ä¸ªå‰ç«¯é¡µé¢
  - 1 ä¸ªå‰ç«¯å¸ƒå±€
  - 1 ä¸ªæ–‡æ¡£
- **æ–°å¢ä»£ç **ï¼šçº¦ 2500 è¡Œ
- **æ–°å¢ API ç«¯ç‚¹**ï¼š15 ä¸ª
- **ä¼˜åŒ–å‰ç«¯é¡µé¢**ï¼š5 ä¸ª

### ğŸš€ ç”Ÿäº§å°±ç»ª
MsgPulse ç°å·²è¾¾åˆ°ç”Ÿäº§çº§åˆ«æ ‡å‡†ï¼Œå¯ä»¥ï¼š
1. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
2. æ‰¿è½½ä¸­ç­‰è§„æ¨¡æ¶ˆæ¯å‘é€ï¼ˆ100+ QPSï¼‰
3. æä¾›å®Œæ•´çš„è¿ç»´ç›‘æ§èƒ½åŠ›
4. ä¿éšœé…ç½®å’Œæ•°æ®å®‰å…¨
5. æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

### ğŸ“ å»ºè®®åç»­ä¼˜åŒ–æ–¹å‘
è™½ç„¶æ ¸å¿ƒåŠŸèƒ½å·²å®Œå¤‡ï¼Œä½†å¯è€ƒè™‘ä»¥ä¸‹å¢å¼ºï¼š
1. **æ€§èƒ½ä¼˜åŒ–**
   - å¼•å…¥ Redis æ›¿ä»£å†…å­˜å»é‡
   - æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
   - æ¶ˆæ¯é˜Ÿåˆ—æ‰©å®¹ç­–ç•¥
2. **é«˜å¯ç”¨**
   - å¤šå®ä¾‹éƒ¨ç½²æ”¯æŒ
   - æ•°æ®åº“ä¸»ä»å¤åˆ¶
   - æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–
3. **å¯è§‚æµ‹æ€§**
   - é›†æˆ Prometheus + Grafana
   - ç»“æ„åŒ–æ—¥å¿—ï¼ˆSerilog + ELKï¼‰
   - åˆ†å¸ƒå¼è¿½è¸ªï¼ˆOpenTelemetryï¼‰

---

## é™„å½•ï¼šæ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶ï¼ˆæœ¬æ¬¡ä¼˜åŒ–ï¼‰
```
backend/MsgPulse.Api/Endpoints/
â”œâ”€â”€ DashboardEndpoints.cs           # ç»Ÿè®¡ç›‘æ§ç«¯ç‚¹
â”œâ”€â”€ HealthEndpoints.cs              # å¥åº·æ£€æŸ¥ç«¯ç‚¹
â””â”€â”€ TemplatePreviewEndpoints.cs     # æ¨¡æ¿é¢„è§ˆç«¯ç‚¹

backend/MsgPulse.Api/Services/
â”œâ”€â”€ MessageDeduplicationService.cs  # æ¶ˆæ¯å»é‡æœåŠ¡
â””â”€â”€ ConfigurationEncryptionService.cs # é…ç½®åŠ å¯†æœåŠ¡

frontend/components/
â””â”€â”€ ConfirmDialog.tsx               # ç¡®è®¤å¯¹è¯æ¡†ç»„ä»¶

frontend/app/
â””â”€â”€ page.tsx                        # ä»ªè¡¨ç›˜é¡µé¢ï¼ˆé‡æ„ï¼‰

docs/
â””â”€â”€ OPTIMIZATION_SUMMARY.md         # æœ¬æ–‡æ¡£
```

### ä¿®æ”¹æ–‡ä»¶ï¼ˆæœ¬æ¬¡ä¼˜åŒ–ï¼‰
```
backend/MsgPulse.Api/
â”œâ”€â”€ Program.cs                      # æ³¨å†Œæ–°ç«¯ç‚¹å’ŒæœåŠ¡
â”œâ”€â”€ MsgPulse.Api.csproj            # å¯ç”¨XMLæ–‡æ¡£
â”œâ”€â”€ Endpoints/
â”‚   â”œâ”€â”€ MessageEndpoints.cs         # é›†æˆå»é‡æœºåˆ¶
â”‚   â””â”€â”€ ManufacturerEndpoints.cs    # é›†æˆåŠ å¯†æœåŠ¡
â””â”€â”€ Services/
    â””â”€â”€ MessageProcessingWorker.cs  # é›†æˆåŠ å¯†æœåŠ¡

frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                  # é›†æˆ ConfirmProvider
â”‚   â”œâ”€â”€ sms-templates/page.tsx      # ä½¿ç”¨ useConfirm
â”‚   â”œâ”€â”€ email-templates/page.tsx    # ä½¿ç”¨ useConfirm
â”‚   â”œâ”€â”€ route-rules/page.tsx        # ä½¿ç”¨ useConfirm
â”‚   â””â”€â”€ channels/page.tsx           # ä½¿ç”¨ useConfirm
```

**æ€»è®¡**ï¼š
- æ–°å¢ä»£ç ï¼šçº¦ 2500 è¡Œ
- ä¿®æ”¹ä»£ç ï¼šçº¦ 200 è¡Œ
- æ–°å¢ API ç«¯ç‚¹ï¼š15 ä¸ª
- ä¼˜åŒ–å‰ç«¯é¡µé¢ï¼š5 ä¸ª
- æ–°å¢åç«¯æœåŠ¡ï¼š2 ä¸ª
- æ–°å¢å‰ç«¯ç»„ä»¶ï¼š1 ä¸ª
